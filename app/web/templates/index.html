<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Amazon Trend Finder AI â€” App</title>

  <!-- Ortak stiller -->
  <link rel="stylesheet" href="/static/css/landing.css?v=1">
  <link rel="stylesheet" href="/static/css/styles.css?v=app-final-7">
</head>

<body data-mode="{{ mode or 'demo' }}">
  <!-- ===== SELF-CONTAINED PRELOADER (shows no matter what) ===== -->
  <div id="preloader" style="
    position:fixed; inset:0; display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    background:rgba(2,6,23,.94); backdrop-filter:blur(2px);
    z-index:10000; transition:opacity .25s ease; opacity:.6s ease;
  ">
    <div style="
      width:42px; height:42px; border-radius:50%;
      border:3px solid rgba(148,163,184,.28);
      border-top-color:#38bdf8; animation:atfspin .9s linear infinite;
    "></div>
    <p id="preloaderText" style="margin-top:12px; font-size:14px; color:#9ca3af;">
      {{ 'Loading Proâ€¦' if (mode=='pro') else 'Loading demoâ€¦' }}
    </p>
  </div>
  <style>@keyframes atfspin{to{transform:rotate(360deg)}}</style>
  <script>
    // KAPATMA: app.js yoksa bile 5 sn sonra kapat (test amaÃ§lÄ±)
   window.preloaderHide = function(){
  var el = document.getElementById('preloader');
  if (!el) return;
  // preloader hemen kapanmasÄ±n, 1 saniye ek bekleme sÃ¼resi
  setTimeout(function() {
    el.style.opacity = '0';
    el.style.pointerEvents = 'none';
    setTimeout(function(){ 
      try{ el.remove(); }catch(e){ el.style.display='none'; } 
    }, 400);
  }, 1000); // ðŸ‘ˆ 1 saniye bekle, sonra yavaÅŸÃ§a kapat
};

    // GÃ¼vence: sayfa tam yÃ¼klenince de kapatmayÄ± dene
    window.addEventListener('load', window.preloaderHide);
    // Test fallback: 5 sn sonra mutlaka kapat (ilk kurulumu doÄŸrulamak iÃ§in)
    setTimeout(function(){
      if (document.getElementById('preloader')) {
        console.log('[preloader] fallback timeout fired -> hide');
        window.preloaderHide();
      }
    }, 5000);
  </script>
  <!-- ===== /SELF-CONTAINED PRELOADER ===== -->

  {% include "_nav.html" %}
  <!-- ... geri kalan iÃ§erik ... -->



  {# Demo bilgilendirme ÅŸeridi â€” CTA sadece burada #}
  {% if mode == 'demo' %}
    <div class="upgrade-banner" role="status">
      Youâ€™re using the free demo. Last 6 weeks only, advanced filters disabled.
      <a href="{{ url_for('checkout') }}" class="btn small">Upgrade to Pro</a>
    </div>
  {% endif %}


  <!-- Filtreler -->
  <section class="controls" aria-labelledby="filtersTitle">
    <h2 id="filtersTitle" class="hidden">Filters</h2>

    <div>
      <label for="start">Start week</label>
      <select id="start" name="start"></select>
    </div>

    <div>
      <label for="end">End week</label>
      <select id="end" name="end"></select>
    </div>

    <div>
      <label for="include">Include (comma-separated)</label>
      <input id="include" name="include" placeholder="iphone, crocs..." autocomplete="off"/>
    </div>

    <div>
      <label for="exclude">Exclude (comma-separated)</label>
      <input id="exclude" name="exclude" placeholder="case, charger..." autocomplete="off"/>
    </div>

    <div class="actions">
      <button id="run" class="btn" aria-label="Find uptrends">Find uptrends</button>
    </div>
  </section>

  <!-- Ã–zet -->
  <section class="summary" aria-live="polite">
    <span id="found" class="pill">Found: 0</span>
    <span id="range" class="pill"></span>

    <span id="status" class="loading hidden" aria-hidden="true">
      <span class="dot"></span><span class="dot"></span><span class="dot"></span> Loadingâ€¦
    </span>
  </section>

  <!-- SonuÃ§ Tablosu -->
  <section aria-labelledby="resultsTitle">
    <h2 id="resultsTitle" class="hidden">Results</h2>
    <table id="tbl">
      <thead>
        <tr>
          <th data-key="term">Term</th>
          <th data-key="start_rank">Start rank</th>
          <th data-key="end_rank">End rank</th>
          <th data-key="total_improvement">Total improvement</th>
          <th data-key="weeks">Weeks</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="empty" class="hidden">No results. Try relaxing your filters.</div>
  </section>

  <!-- Modal (grafik) -->
  <div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-card">
      <div class="modal-header">
        <h3 id="modalTitle">Trend</h3>
        <button id="closeModal" class="btn" aria-label="Close">âœ•</button>
      </div>
      <div id="chart" class="chart"></div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>

  <!-- App JS -->
  <script src="/static/js/app.js" defer></script>
</body>
</html>
